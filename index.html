<!DOCTYPE html>
<html>
<head>
  <title>PDF Generator</title>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/html2pdf.js/0.10.1/html2pdf.bundle.min.js"></script>
</head>
<body>
  <div id="target"></div>

  <script>
    window.addEventListener("message", async (e) => {
      const html = e.data.html;
      document.getElementById("target").innerHTML = html;

      // Wait for rendering to settle
      await new Promise(res => setTimeout(res, 100));

      // Generate PDF
      html2pdf().from(document.getElementById("target")).save("document.pdf");

      // Optional: Auto-close tab
      setTimeout(() => window.close(), 3000);
    });
  </script>
</body>
</html><!-- index.html (Main Tab) -->
<!DOCTYPE html>
<html>
<head>
  <title>Main Page</title>
</head>
<body>
  <h1>HTML to PDF via New Tab</h1>
  <div id="content">
    <h2>Invoice</h2>
    <p>This is a sample invoice generated via a new tab.</p>
  </div>
  <button onclick="openPDFTab()">Generate PDF</button>

  <script>
    function openPDFTab() {
      const content = document.getElementById("content").innerHTML;
      const pdfTab = window.open("pdf-generator.html", "_blank");

      // Wait until the tab is ready to receive the message
      const interval = setInterval(() => {
        if (pdfTab && pdfTab.document.readyState === 'complete') {
          clearInterval(interval);
          pdfTab.postMessage({ html: content }, "*");
        }
      }, 200);
    }
  </script>
</body>
</html>
